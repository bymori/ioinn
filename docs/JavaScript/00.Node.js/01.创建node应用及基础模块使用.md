---
title: 创建node应用及基础模块使用
date: 2021-10-29 14:21:32
permalink: /pages/f8b3f0/
categories:
  - JavaScript
  - js
  - node
tags:
  - node
---

## Node.js创建第一个应用

如果我们使用PHP来编写后端的代码时，需要Apache或者Nginx的HTTP服务器，来处理客户端的请求相应。`不过对Node.js来说，概念完全不一样了。使用Node.js时，我们不仅仅在实现一个应用，同时还实现了整个HTTP服务器`

<!-- more -->
1. 引入http模块
  
  ```js
  //表示引入http模块
  var http = require('http');
  ```

2. 创建服务器
  
  接下来我们使用http.createServer()方法创建服务器，并使用listen方法绑定8081端口。函数通过request,response参数来接收和响应数据

  ```js
  var http = require('http');
  /*
      request    获取客户端传过来的信息
      response  给浏览器响应信息
  */
  http
    .createServer(function (request, response) {
      //设置响应头
      response.writeHead(200, { 'Content-Type': 'text/plain' });
      //表示给我们页面上面输出一句话并且结束响应
      response.end('Hello World 111');
    })
    .listen(8081); //端口

  //终端打印如下信息
  console.log('Server running at http://127.0.0.1:8081/');

  
  ```

3. 运行程序
  
  用命令行切换到程序对应目录。通过node命令运行程序。
  ![image](https://cdn.jsdelivr.net/gh/bymori/image-PicX@main/blog/image.5puf0icbxvg0.png)
  本地写一个js，不能直接拖入浏览器运行，但是有了node，我们任何一个js文件，都可以通过node来运行。`也就是说，node就是一个js的执行环境。`

## HTTP模块、URL模块

Node.js 中，将很多的功能，划分为了一个个 module（模块）。 Node.js 中的很多功能都
是通过模块实现

- HTTP 和 URL 模块的使用

  ```js
  const http = require('http');
  const url = require('url');
  /*
      req   获取客户端传过来的信息
      res  给浏览器响应信息
  */
  http
    .createServer((req, res) => {
      //http://127.0.0.1?name=zhangsan&age=20  想获取url传过来的name 和age

      //设置响应头
      //状态码是 200，文件类型是 html，字符集是 utf-8
      res.writeHead(200, { 'Content-type': "text/html;charset='utf-8'" }); //解决乱码
      res.write("<head> <meta charset='UTF-8'></head>"); //解决乱码
      console.log(req.url); //获取浏览器访问的地址

      if (req.url != '/favicon.ico') {
        var userInfo = url.parse(req.url, true).query;

        console.log(`姓名：${userInfo.name}--年龄:${userInfo.age}`);
      }

      res.end('你好nodejs'); //结束响应
    })
    .listen(8081);
  ```

## Nodejs 自启动工具 nodemen

nodemon是一种工具，可以自动检测到目录中的文件更改时通过重新启动应用程序来调试基于node.js的应用程序

- 安装

```bash
npm install -g nodemon
//或
npm install --save-dev nodemon
```

- 使用

```bash
nodemon   ./main.js // 启动node服务
nodemon ./main.js localhost 6677 // 在本地6677端口启动node服务
"start": "ts-node -r tsconfig-paths/register nodemon src/main.ts",
```

- 延迟重启

```bash
nodemon -delay10 main.js

nodemon --delay 2.5 server.js

nodemon --delay 2500ms server.js
```

这个就类似于js函数中的函数节流,只在最后一次更改的文件往后延迟重启.避免了短时间多次重启的局面.

- 配置文件

nodemon支持本地和全局配置文件。这些通常是命名的nodemon.json，可以位于当前工作目录或主目录中。可以使用该`--config <file>`选项指定备用本地配置文件。

```json
{
  "verbose": true,
  "ignore": ["*.test.js", "fixtures/*"],
  "execMap": {
    "rb": "ruby",
    "pde": "processing --sketch={{pwd}} --run"
  }
}
```

[nodemonDoc](https://www.npmjs.com/package/nodemon)
