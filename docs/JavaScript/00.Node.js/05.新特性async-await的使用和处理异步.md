---
title: 新特性async-await的使用和处理异步
date: 2021-10-31 18:41:16
permalink: /pages/f2e91f/
categories:
  - JavaScript
  - js
tags:
  - Async
  - Await
  - Promise
---

## Es6 常见语法的使用

1. let const
2. 箭头函数
3. 对象、属性的简写
4. 模板字符串
5. Promise
<!-- more -->
## Async、Await 和 Promise 的使用

**async** 是“异步”的简写，而 **await** 可以认为是 async wait 的简写。所以应该很好理解 async
用于申明一个异步的 function ，而 await 用于等待一个异步方法执行完成。
**简单理解：**
**async** 是让方法变成异步。
**await** 是等待异步方法执行完成。
**详细说明：**
**async 是让方法变成异步**，在终端里用 node 执行这段代码，你会发现输出了 `Promise {‘Hello async’ }`，这时候会发现它返回的是 Promise

```js
async function main() {
  var data = await test(); //获取异步方法里面的数据
  console.log(data);
}
main();
```

**await 在等待 async 方法执行完毕**，其实 await 等待的只是一个表达式，这个表达式在官方文档里说的是 Promise 对象，但是它也可以接受普通值。

::: warning 注意: await 必须在 async 方法中
才可以使用因为 await 访问本身就会造成程序停止堵塞，所以必须在异步方法中才可以使用。
:::

```js
//  回调函数 获取异步方法里面的数据
function getData(callbck) {
  //ajax
  setTimeout(function () {
    var name = '张三';
    callbck(name);
  }, 1000);
}

//外部获取异步方法里面的数据
getData(function (data) {
  console.log(data + '111');
});

```

**async/await 同时使用**
async 会将其后的函数（函数表达式或 Lambda）的返回值封装成一个 Promise 对象，而await 会等待这个 Promise 完成，并将其 resolve 的结果返回出来

```js
//  Promise来处理异步  resolve 成功的回调函数   reject失败的回调函数
var p = new Promise(function (resolve, reject) {
  //ajax
  setTimeout(function () {
    var name = '张三 Promise';
    if (Math.random() < 0.7) {
      resolve(name);
    } else {
      reject('失败 Promise');
    }
  }, 1500);
});

p.then((data) => {
  console.log(data);
});

//获取异步方法里面的数据;
function getData(resolve, reject) {
  //ajax
  setTimeout(function () {
    var name = '张三 22';
    resolve(name);
  }, 2000);
}

var p1 = new Promise(getData);

p1.then((data) => {
  console.log(data);
});
```