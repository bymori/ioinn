---
title: fs模块的使用
date: 2021-10-31 18:29:59
permalink: /pages/a21f8a/
categories:
  - JavaScript
  - js
tags:
  - fs模块
---
## 目录

 1. fs.stat   检测是文件还是目录
 2. fs.mkdir  创建目录
 3. fs.writeFile  创建写入文件
 4. fs.appendFile 追加文件
 5. fs.readFile 读取文件
 6. fs.readdir读取目录
 7. fs.rename 重命名 移动文件
 8. fs.rmdir  删除目录
 9. fs.unlink 删除文件
 10. fs.createReadStream 从文件流中读取数据
 11. fs.createWriteStream 写入文件
 12. 管道流
<!-- more -->
### 1. fs.stat   检测是文件还是目录

```js
// fs.stat('./html', (err, data) => {
fs.stat('./package.json', (err, data) => {
  if (err) {
    console.log(err);
    return;
  }

  console.log(`是文件：${data.isFile()}`);
  console.log(`是目录：${data.isDirectory()}`);
});
```

### 2. fs.mkdir  创建目录

```js
/*
 *  path            将创建的目录路径
 *  mode            目录权限（读写权限），默认777
 *  callback        回调，传递异常参数err
 */

fs.mkdir('./css', (err) => {
  if (err) {
    // console.log(err);
    console.log(`目录已存在`);
    return;
  }

  console.log(`创建成功`);
});
```

### 3. fs.writeFile  创建写入文件

```js
/*
    filename      (String)            文件名称
    data        (String | Buffer)    将要写入的内容，可以使字符串 或 buffer数据。
    options        (Object)           option数组对象，包含：
    · encoding   (string)            可选值，默认 ‘utf8′，当data使buffer时，该值应该为 ignored。
    · mode         (Number)        文件读写权限，默认值 438
    · flag            (String)            默认值 ‘w'
    callback {Function}  回调，传递一个异常参数err。
*/

// fs.writeFile('./html/index.html', 'hello nodejs', (err) => {
fs.writeFile('./html/index.html', 'hello ioinn nodejs', (err) => {
  if (err) return console.log(err);
  console.log('创建写入文件成功');
});
```

### 4. fs.appendFile 追加文件

```js
// fs.appendFile('./css/base.css', 'body{color:red}', (err) => {
fs.appendFile('./css/base.css', 'h3{color:red}\n', (err) => {
  if (err) return console.log(err);
  console.log('appendFile 追加文件成功');
});
```

### 5. fs.readFile 读取文件

```js
// fs.readFile('./html/index.html', (err, data) => {
fs.readFile('./aa/index.html', (err, data) => {
  if (err) {
    if (err.errno === -4058) {
      console.log('文件或目录不存在');
    } else {
      console.log(err);
    }
    return;
  }
  console.log(data);
  console.log(data.toString());
});
```

### 6. fs.readdir 读取目录

```js
fs.readdir('./html', (err, data) => {
  if (err) return console.log(err);
  console.log(data);
});
```

### 7. fs.rename 重命名 移动文件

```js
fs.rename('./css/aaa.css', './css/index.css', (err) => {
  if (err) return console.log(err);
  console.log('重命名成功');
});

fs.rename('./css/index.css', './html/index_move.css', (err) => {
  if (err) return console.log(err);
  console.log('移动文件成功');
});
```

### 8. fs.rmdir  删除目录

```js
fs.rmdir('./aaaaa', (err) => {
  if (err) return console.log(err);
  console.log('删除目录成功');
});
```

### 9. fs.unlink 删除文件

```js
fs.unlink('./aa/index.html', (err) => {
  if (err) return console.log(err);
  console.log('删除文件成功');
});
```

### 10. fs.createReadStream 从文件流中读取数据

```js
//  从文件流中读取数据
const fs = require('fs');
var readStream = fs.createReadStream('./data/input.txt');

var count = 0;
var str = '';
readStream.on('data', (data) => {
  str += data;
  count++;
});

readStream.on('end', () => {
  console.log(str);
  console.log(count);
});

readStream.on('error', (err) => {
  console.log(err);
});
```

### 11. fs.createWriteStream 写入文件

```js
//  写入文件
const fs = require('fs');
var str = '';

for (var i = 0; i < 500; i++) {
  str += '我是从数据库获取的数据，我要保存起来' + i + '\n';
}

var writeStream = fs.createWriteStream('./data/output.txt');

writeStream.write(str);

//标记文件末尾
writeStream.end();

writeStream.on('finish', () => {
  console.log('写入完成');
});

```

### 12. 管道流

管道提供了一个输出流到输入流的机制。通常我们用于从一个流中获取数据并将数据传递到另外一个流中

![image](https://cdn.jsdelivr.net/gh/bymori/image-PicX@main/blog/image.3srif687oha0.png)

如上面的图片所示，我们把文件比作装水的桶，而水就是文件里的内容，我们用一根管子(pipe)连接两个桶使得水从一个桶流入另一个桶，这样就慢慢的实现了大文件的复制过程。

以下实例我们通过读取一个文件内容并将内容写入到另外一个文件中。

```js
// 管道流

const fs = require('fs');
var readStream = fs.createReadStream('./aaa.png');

var writeStream = fs.createWriteStream('./data/aaa.png');

readStream.pipe(writeStream);
```