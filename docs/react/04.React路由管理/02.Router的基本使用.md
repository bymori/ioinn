---
title: Router的基本使用
date: 2021-12-16 20:57:30
permalink: /pages/ee854a/
categories:
  - react
  - React路由管理
tags:
  - 
---
## react-router

目前前端流行的三大框架, 都有自己的路由实现:

- Angular的`ngRouter`
- React的`react-router`
- Vue的`vue-router`

React Router的版本4开始，路由不再集中在一个包中进行管理了
<!-- more -->
- `react-router`是router的核心部分代码
- `react-router-dom`是用于浏览器的
- `react-router-native`是用于原生应用的

**目前使用最新的React Router版本是v6的版本**

- v6版本相较v5修改内容较多 详见下文对比
- [React Router v6 Preview](https://reacttraining.com/blog/react-router-v6-pre/)

**安装react-router**：

安装`react-router-dom`会自动帮助我们安装`react-router`的依赖

```shell
yarn add react-router-dom
```

## Router的基本使用

`react-router`最主要的API是给我们提供的一些组件：

**BrowserRouter或HashRouter**：

- Router中包含了对路径改变的监听，并且会将相应的路径传递给子组件
- `BrowserRouter`使用history模式
- `HashRouter`使用hash模式

**Link和NavLink**：

- 通常路径的跳转是使用`Link组件`，最终会被渲染成`a元素`
- `NavLink`是在Link基础之上增加了一些样式属
- `to属性`：Link中最重要的属性，用于设置跳转到的路径

**Route**：

- `Route`用于路径的匹配
- `path属性`：用于设置匹配到的路径
- `component属性`：设置匹配到路径后，渲染的组件
- `exact`：精准匹配，只有精准匹配到完全一致的路径，才会渲染对应的组件

```js
import React, { PureComponent } from 'react';

import {
  BrowserRouter,
  Link,
  Route,
} from 'react-router-dom';

import Home from './pages/home';
import About from './pages/about';
import Profile from './pages/profile';

export default class App extends PureComponent {
  render(){
    return(
      <BrowserRouter>
        <Link to="/">首页</Link>
        <Link to="/about">关于</Link>
        <Link to="/profile">我的</Link>

        <Route path="/" component={Home} />
        <Route path="/about/*" component={About} />
        <Route path="/profile" component={Profile}>
      </BrowserRouter>
    )
  }
}
```

相较于v5写法 这里 `<Route>` 需要包裹在`<Routes>`里面 否则报错
`component/render`被`element`替代

```js
Error: 
A <Route> is only ever to be used as the child of <Routes> element,
never rendered directly. Please wrap your <Route> in a <Routes>.

import {
  //...
  Routes,
} from 'react-router-dom';

<Routes>
    <Route path="/" element={<Home />} />
    <Route path="/about/*" element={<About />} />
    <Route path="/profile" element={<Profile />}>
</Routes>
```

### NavLink的使用

**需求：路径选中时，对应的a元素变为红色**

这个时候，需要使用**NavLink组件**来**替代Link组件**：

- `activeStyle`：活跃时（匹配时）的样式
- `activeClassName`：活跃时添加的class
- `exact`：是否精准匹配

不过 在v6版本中 已经从`<NavLink />`组件中删除了 `activeClassName` 和`activeStyle` 但是,在v6版本中 `<NavLink />`允许 给`style`传递一个函数 可以在该函数中定义样式或字符串

详细参考：[Remove and props from activeClassNameactiveStyle<NavLink />](https://reactrouter.com/docs/en/v6/upgrading/v5#remove-activeclassname-and-activestyle-props-from-navlink-)

```js
<NavLink
  to="/messages"
- style={{ color: 'blue' }}
- activeStyle={{ color: 'green' }}
+ style={({ isActive }) => ({ color: isActive ? 'green' : 'blue' })}
>
  Messages
</NavLink>
```

但是，我们会发现在选中`about`或`profile`时，第一个也会变成红色

- 原因是`/`路径也匹配到了`/about`或`/profile`
- 这个时候，我们可以在第一个NavLink中添加上exact属性
- BUT!!! v6中 不需要添加 `exact` 也是可以的

**默认的activeClassName**：

- 事实上在默认匹配成功时，NavLink就会添加上一个动态的active class；
- 所以我们也可以直接编写样式
- 当然，如果你担心这个class在其他地方被使用了，出现样式的层叠，也可以自定义class

```js
const activeClassName = ({ isActive }) => (isActive ? 'link-active' : '');
```

这时 active class名称为 `link-active` 或 `空`

### ~~Switch~~的作用 重命名为 Routes

`<Switch>`重命名为`<Routes>`
该顶级组件将被重命名。但是，其功能大部分保持不变

```js
// v5
<Switch>
    <Route exact path="/"><Home /></Route>
    <Route path="/profile"><Profile /></Route>
</Switch>

// v6
<Routes>
    <Route path="/" element={<Home />} />
    <Route path="profile/*" element={<Profile />} />
</Routes>

```

### Redirect

Redirect用于路由的重定向，当这个组件出现时，就会执行跳转到对应的to路径中

**案例**：

- 用户跳转到User界面
- 但是在User界面有一个isLogin用于记录用户是否登录
  - `true`：那么显示用户的名称
  - `false`：直接重定向到登录界面

```js
import React, { PureComponent } from 'react';

// Normal <Redirect> elements that are not inside a <Switch> are ok to remain. They will become <Navigate> elements in v6.
import { Navigate } from 'react-router-dom';

export default class User extends PureComponent {
  constructor(props) {
    super(props);

    this.state = {
      isLogin: true,
    };
  }

  render() {
    return this.state.isLogin ? (
      <div>
        <h2>User</h2>
        <h3>用户名:沫沫</h3>
      </div>
    ) : (
      <Navigate to="/login" />
    );
  }

  // 因为 react-router-dom v6 版本中删除了 Redirect 故 使用Navigate 替代相同效果
}
```

## 路由的嵌套

在开发中，路由之间是存在嵌套关系的。

- 假设about页面中有两个页面内容
  - 商品列表和消息列表
  - 点击不同的链接可以跳转到不同的地方，显示不同的内容

### 手动路由跳转

目前实现的跳转主要是通过`Link`或者`NavLink`进行跳转的，实际上我们也可以通过`JavaScript代码`进行跳转

