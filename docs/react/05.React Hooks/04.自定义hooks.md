---
title: 自定义hooks
date: 2021-12-17 22:30:32
permalink: /pages/73b052/
categories:
  - react
  - React Hooks
tags:
  - 
---
## 自定义hooks

自定义Hook本质上只是一种函数代码逻辑的抽取，严格意义上来说，它本身并不算React的特性。
<!-- more -->

**需求**：所有的组件在创建和销毁时都进行打印

- 组件被创建：打印 组件被创建了
- 组件被销毁：打印 组件被销毁了

```js
import React, { useEffect } from 'react';

const Home = (props) => {
  useLoggingLife('Home');
  return <h2>Home</h2>;
};

const Profile = (props) => {
  useLoggingLife('Profile');
  return <h2>Profile</h2>;
};

export default function CustomLifeHookDemo01() {
  useLoggingLife('CustomLifeHookDemo01');
  return (
    <div>
      <h2>CustomLifeHookDemo01</h2>
      <Home />
      <Profile />
    </div>
  );
}

function useLoggingLife(name) {
  useEffect(() => {
    console.log(`${name}组件被创建出来了`);

    return () => {
      console.log(`${name}组件被销毁掉了`);
    };
  }, []);
}
```

## 自定义Hook练习

### Context共享

```js
import { useContext } from 'react';
import { UserContext, TokenContext } from '../App';

function useUserContext() {
  const user = useContext(UserContext);
  const token = useContext(TokenContext);

  return [user, token];
}

export default useUserContext;

// 使用
export default function CustomContextShareHook() {
  const [user, token] = useUserContext();
  console.log(user, token);

  return <div>CustomContextShareHook</div>;
}
```

### 获取滚动位置

```js
function useScrollPosition() {
  const [scrollPosition, setScrollPosition] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      setScrollPosition(parseInt(window.scrollY));
    };
    document.addEventListener('scroll', handleScroll);

    return () => {
      document.addEventListener('scroll', handleScroll);
    };
  }, []);

  return scrollPosition;
}

export default function CustomScrollPositionHook() {
  const position = useScrollPosition();

    // ...
}
```

### localStorage存储

```js
import { useState, useEffect } from 'react';

function useLocalStorage(key) {
  const [name, setName] = useState(() => {
    // const name = window.localStorage.getItem('name');
    const name = JSON.parse(window.localStorage.getItem(key));
    return name;
  });

  useEffect(() => {
    window.localStorage.setItem(key, JSON.stringify(name));
  }, [name]);

  return [name, setName];
}

export default useLocalStorage;

// 使用
export default function CustomDataStoreHook() {
  const [name, setName] = useLocalStorage('name');

  return (
    <div>
      <h3>CustomDataStoreHook-{name}</h3>
      <button onClick={(e) => setName('momo')}>设置name</button>
    </div>
  );
}
```
