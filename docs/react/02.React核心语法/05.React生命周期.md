---
title: React生命周期
date: 2021-12-15 16:14:00
permalink: /pages/950020/
categories:
  - react
  - React核心语法
tags:
  - 
---
## React生命周期

- 很多的事物都有从创建到销毁的整个过程，这个过程称之为是**生命周期**
- React组件也有自己的生命周期，了解组件的生命周期可以让我们在最合适的地方完成自己想要的功能

<!-- more -->

- 生命周期和生命周期函数的关系：
- 生命周期是一个抽象的概念，在生命周期的整个过程，分成了很多个阶段
  - 比如装载阶段（**Mount**），组件第一次在DOM树中被渲染的过程；
  - 比如更新过程（**Update**），组件状态发生变化，重新更新渲染的过程；
  - 比如卸载过程（**Unmount**），组件从DOM树中被移除的过程
- React内部为了告诉我们当前处于哪些阶段，会对我们组件内部实现的某些函数进行回调，这些函数就是生命周期函数：
  - 比如实现`componentDidMount`函数：组件已经挂载到DOM上时，就会回调；
  - 比如实现`componentDidUpdate`函数：组件已经发生了更新时，就会回调；
  - 比如实现`componentWillUnmount`函数：组件即将被移除时，就会回调；
  - 我们可以在这些回调函数中编写自己的逻辑代码，来完成自己的需求功能；
- 我们谈React生命周期时，主要谈的类的生命周期，因为函数式组件是没有生命周期函数的；（可以通过hooks来模拟一些生命周期的回调）

![生命周期图谱](https://cdn.jsdelivr.net/gh/bymori/image-PicX@main/img/lnh6siwctc-1639386097846.png)
[生命周期图谱](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)

**Constructor**

- 如果不初始化 state 或不进行方法绑定，则不需要为 React 组件实现构造函数。
- constructor中通常只做两件事情：
  - 通过给 this.state 赋值对象来初始化内部的state
  - 为事件绑定实例（this）

```js
  constructor() {
    super();

    this.state = {
      counter: 0,
      isShow: true,
    };

    console.log('执行了组件的 constructor 方法');
  }
```

**componentDidMount**

- componentDidMount() 会在组件挂载后（插入 DOM 树中）立即调用。
- componentDidMount中通常进行哪里操作呢？
  - 依赖于DOM的操作可以在这里进行；
  - 在此处发送网络请求就最好的地方；（官方建议）
  - 可以在此处添加一些订阅（会在componentWillUnmount取消订阅）；

```js
  componentDidMount() {
    // 组件挂载完成
    console.log('执行了组件的 componentDidMount 方法');
  }
```

**componentDidUpdate**

- componentDidUpdate() 会在更新后会被立即调用，首次渲染不会执行此方法。
  - 当组件更新后，可以在此处对 DOM 进行操作；
  - 如果你对更新前后的 props 进行了比较，也可以选择在此处进行网络请求；（例如，当 props 未发生变化时，则不会执行网络请求）。

```js
  componentDidUpdate(prevProps, prevState, snapshot) {
    console.log('执行了组件的 componentDidUpdate 方法');
    console.log('prevProps: ', prevProps);
    console.log('prevState: ', prevState);
    console.log('snapshot: ', snapshot);
  }
```

**componentWillUnmount**

- componentWillUnmount() 会在组件卸载及销毁之前直接调用。
  - 在此方法中执行必要的清理操作；
  - 例如，清除 timer，取消网络请求或清除在 componentDidMount() 中创建的订阅等

```js
  componentWillUnmount() {
    console.log('调用了Cpn的 componentWillUnmount 方法');
  }
```

### 不常用生命周期函数

![生命周期图谱](https://cdn.jsdelivr.net/gh/bymori/image-PicX@main/img/qu62xtrmj6-1639395533574.png)
[生命周期图谱](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)

除了上面介绍的生命周期函数之外，还有一些不常用的生命周期函数：

- **getDerivedStateFromProps**：state 的值在任何时候都依赖于 props时使用；该方法返回一个对象来更新state
- **getSnapshotBeforeUpdate**：在React更新DOM之前回调的一个函数，可以获取DOM更新前一些信息（比如说滚动位置）
- **shouldComponentUpdate**：该生命周期函数很常用 用于性能优化