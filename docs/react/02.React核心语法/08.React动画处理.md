---
title: React动画处理
date: 2021-12-15 11:24:09
permalink: /pages/731e30/
categories:
  - react
  - React核心语法
tags:
  - Transition
---
## react-transition-group 介绍

在开发中，给一个组件的显示和消失添加某种过渡动画，可以很好的增加用户体验。

可以通过原生的CSS来实现这些过渡动画，但是React社区为我们提供了`react-transition-group`用来完成过渡动画。

<!-- more -->

React曾为开发者提供过动画插件 `react-addons-css-transition-group`，后由社区维护，形成了现在的 `react-transition-group` [React Transition Group](https://reactcommunity.org/react-transition-group/)

- 这个库可以帮助我们方便的实现组件的 入场 和 离场 动画，使用时需要进行额外的安装：

```shell
npm install react-transition-group --save
# OR
yarn add react-transition-group
```

`react-transition-group`本身非常小，不会为我们应用程序增加过多的负担

### react-transition-group主要组件

**react-transition-group主要包含四个组件**

- **Transition**
  - 该组件是一个和平台无关的组件（不一定要结合CSS）；
  - 在前端开发中，我们一般是结合CSS来完成样式，所以比较常用的是CSSTransition；
- **CSSTransition**
  - 在前端开发中，通常使用CSSTransition来完成过渡动画效果
- **SwitchTransition**
  - 两个组件显示和隐藏切换时，使用该组件
- **TransitionGroup**
  - 将多个动画组件包裹在其中，一般用于列表中元素的动画

#### CSSTransition

**CSSTransition是基于Transition组件构建的：**

CSSTransition执行过程中，有三个状态：`appear`、`enter`、`exit`

- 它们有三种状态，需要定义对应的CSS样式：
  - 第一类，**开始状态**：对于的类是`-appear`、`-enter`、`exit`
  - 第二类：**执行动画**：对应的类是`-appear-active`、`-enter-active`、`-exit-active`
  - 第三类：**执行结束**：对应的类是`-appear-done`、`-enter-done`、`-exit-done`

#### CSSTransition常见对应的属性

- **in**：触发进入或者退出状态
  - 如果添加了unmountOnExit={true}，那么该组件会在执行退出动画结束后被移除掉；
  - 当in为true时，触发进入状态，会添加-enter、-enter-acitve的class开始执行动画，当动画执行结束后，会移除两个class，并且添加-enter-done的class；
  - 当in为false时，触发退出状态，会添加-exit、-exit-active的class开始执行动画，当动画执行结束后，会移除两个class，并且添加-enter-done的class
- **classNames**：动画class的名称
  - 参数classNames="star" 决定了在编写css时，对应的class名称：比如star-enter、star-enter-active、star-enter-done；

```js
classNames={{
 appear: 'my-appear',
 appearActive: 'my-active-appear',
 enter: 'my-enter',
 enterActive: 'my-active-enter',
 enterDone: 'my-done-enter,
 exit: 'my-exit',
 exitActive: 'my-active-exit',
 exitDone: 'my-done-exit,
}}
```

- **timeout**：过渡动画的时间
- **appear**：是否在初次进入添加动画（需要和in同时为true）
- **unmountOnExit**：退出后卸载组件
  - 其他属性可以参考官网来学习：
  - [https://reactcommunity.org/react-transition-group/transition](https://reactcommunity.org/react-transition-group/transition)

CSSTransition对应的钩子函数：主要为了检测动画的执行过程，来完成一些JavaScript的操作

- onEnter：在进入动画之前被触发；
- onEntering：在应用进入动画时被触发；
- onEntered：在应用进入动画结束后被触发；

```js
// 三个进入状态的事件，可以做你想做的事情
onEnter = (node, isAppearing) => {
  console.log(isAppearing, 'onEnter')
}
onEntering = (node, isAppearing) => {
  console.log(isAppearing, 'onEntering')
}
onEntered = (node, isAppearing) => {
  console.log(isAppearing, 'onEntered')
}
```

#### SwitchTransition

**SwitchTransition可以完成两个组件之间切换的炫酷动画**：

- 比如我们有一个按钮需要在on和off之间切换，我们希望看到on先从左侧退出，off再从右侧进入
- 这个动画在vue中被称之为 `vue transition modes`
- `react-transition-group`中使用`SwitchTransition`来实现该动画

**SwitchTransition中主要有一个属性：mode，有两个值**

- **in-out**：表示新组件先进入，旧组件再移除
- **out-in**：表示就组件先移除，新组建再进入

**如何使用SwitchTransition呢？**

- SwitchTransition组件里面要有CSSTransition或者Transition组件，不能直接包裹你想要切换的组件
- SwitchTransition里面的CSSTransition或Transition组件不再像以前那样接受in属性来判断元素是何种状态，取而代之的是**key属性**

```js
import React, { PureComponent } from 'react';

import './SwitchTransition.css';

import { SwitchTransition, CSSTransition } from 'react-transition-group';

export default class SwitchTransitionDemo extends PureComponent {
  constructor(props) {
    super(props);

    this.state = {
      isOn: true,
    };
  }

  render() {
    const { isOn } = this.state;

    return (
      <div>
        <SwitchTransition mode="out-in">
          <CSSTransition
            key={isOn ? 'on' : 'off'}
            classNames="btn"
            timeout={1000}>
            <button onClick={(e) => this.setState({ isOn: !isOn })}>
              {isOn ? 'on' : 'off'}
            </button>
          </CSSTransition>
        </SwitchTransition>
      </div>
    );
  }
}
```

#### TransitionGroup

当有一组动画时，需要将这些`CSSTransition`放入到一个`TransitionGroup`中来完成动画

```js
<TransitionGroup>
  {this.state.names.map((item, index) => {
    return (
      <CSSTransition key={item} timeout={500} classNames="item">
        <div>
          {item}
          <button onClick={(e) => this.removeItem(index)}>-</button>
        </div>
      </CSSTransition>
    );
  })}
</TransitionGroup>
```