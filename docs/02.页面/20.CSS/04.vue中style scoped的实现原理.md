---
title: vue中style scoped的实现原理 | vue中样式隔离方案 | 组件样式穿透如何做？
date: 2022-01-31 23:36:35
permalink: /pages/1b68f2/
categories:
  - 页面
  - CSS
tags:
  - 
---

[Vue.js style scoped 官方文档](https://v3.cn.vuejs.org/api/sfc-style.html#style-scoped)

## scoped属性的作用

使 SCF CSS 只对当前组件生效，不对子组件和三方组件生效

```vue
<!-- 父组件 -->
<template>
  <div class="hello">
    <h1>Hello,World</h1>
    <hi-World />
  </div>
</template>

<style scoped>
.hello h1 {
  color: red;
}
</style>

<!-- 子组件 hi-World -->
<template>
  <div >
    <h1>Hi World!</h1>
  </div>
</template>
```

在线演示
https://stackblitz.com/edit/vitejs-vite-nwo6sr?file=src/App.vue&terminal=dev

## 样式穿透

如果这时候需要子组件的样式同样被修改 就要使用 样式穿透进行操作

### Vue2写法

Vue2的写法在Vue3中也会生效,但是这种写法在Vue3中已经被弃用

1. 使用Sass等预处理器时 `::v-deep`
   
```vue
::v-deep .child-class {
  background-color:#000;
}
```
   
2. 不使用预处理器时:`>>>`

```vue
>>> .child-class {
  background-color:#000;
}
```

### Vue3写法

在Vue3中, 前缀`::v-`已经被弃用了,而且我们不论是使用了`Sass`等预处理器,都可以只是用统一的`:dee`p选择器,不过现在推荐使用的是带括号的选择器

```vue
:v-deep(.child-class) {
  background-color:#000;
}
```

### 全局选择器

如果想让其中一个样式规则应用到全局，比起另外创建一个 `<style>`，可以使用 `:global` 伪类来实现 (看下面的代码)：

```vue
<style scoped>
:global(.red) {
  color: red;
}
</style>
```

#### 混合使用局部与全局样式

也可以在同一个组件中同时包含作用域样式和非作用域样式：

```vue
<style>
/* global styles */
</style>

<style scoped>
/* local styles */
</style>
```

## scoped原理 : PostCSS 

当 `<style>` 标签带有 scoped 属性的时候，它的 CSS 只会应用到当前组件的元素上。这类似于 `Shadow DOM` 中的样式封装。它带有一些注意事项，不过好处是不需要任何的 polyfill。它是通过 `PostCSS` 转换以下内容来实现的：

```vue
<style scoped>
.example {
  color: red;
}
</style>

<template>
  <div class="example">hi</div>
</template>
```

转换为：

```vue
<style>
.example[data-v-f3f3eg9] {
  color: red;
}
</style>

<template>
  <div class="example" data-v-f3f3eg9>hi</div>
</template>
```

## scoped拓展

- 好处: 当使用`scoped`时，父组件的样式不会泄露到子组件中。

但是 `子组件的根节点`会同时被被 父组件的作用域样式 和 子组件的作用域样式 所影响

这是有意为之的 这样父组件可以出于布局的原因去改变子组件`根节点`的样式

:::TIP
通过 `v-html` 创建的 DOM 内容不会被作用域样式影响，但你仍然可以使用深度选择器来设置其样式。
:::